var draw=function(){var e=document.querySelector("main").offsetWidth,t=document.querySelector("main").offsetHeight,n=document.createElement("canvas"),i=n.getContext("2d"),o=n.getBoundingClientRect(),r=0,l=0,a=0,s=0,d=0,c=0,u=0,h=0,g="",f=!1,y="",w="",S=[],m=0,k=[];return{randColor:function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},setStrokeColor:function(e){y=e},setFillColor:function(e){w=e},getStrokeColor:function(){return 6<y.length?y:this.randColor()},getFillColor:function(){return 6<w.length?w:this.randColor()},setPoint:function(){S[m]=[],S[m].x=r,S[m].y=l,2<S.length?(this.draw(),m=0,S=[]):m++},setXY:function(e){u=r,h=l,r=e.clientX-o.left-n.offsetLeft,l=e.clientY-o.top-n.offsetTop},writeXY:function(){document.getElementById("trackX").innerHTML="X: "+r,document.getElementById("trackY").innerHTML="Y: "+l},setIsDrawing:function(e){f=e},getIsDrawing:function(){return f},setShape:function(e){g=e},setStart:function(){a=r,s=l},setEnd:function(){d=r,c=l},getCanvas:function(){return n},getShape:function(){return g},draw:function(){i.restore(),"rectangle"===g?this.drawRect():"line"===g?this.drawLine():"circle"===g?this.drawCircle():"path"===g?this.drawPath():"triangle"===g?this.drawTriangle():"3-point"===g?this.draw3Point():alert("Please choose a shape"),i.save(),console.log(k)},drawLine:function(){i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(a,s),i.lineTo(d,c),i.stroke(),k.push({shape:"line",cords:{x1:a,y1:s,x2:d,y2:c},styles:{stroke:i.strokeStyle}})},drawRect:function(){i.fillStyle=this.getFillColor(),i.strokeStyle=this.getStrokeColor(),i.fillRect(a,s,d-a,c-s),i.strokeRect(a,s,d-a,c-s),k.push({shape:"rect",cords:{x1:a,y1:s,x2:d,y2:c},styles:{stroke:i.strokeStyle,fill:i.fillStyle}})},drawCircle:function(){i.fillStyle=this.getFillColor(),i.strokeStyle=this.getStrokeColor(),i.beginPath();var e=a-d,t=s-c;radius=Math.sqrt(e*e+t*t),i.arc(a,s,radius,0,2*Math.PI),i.stroke(),i.fill(),k.push({shape:"circle",cords:{x1:a,y1:s,x2:d,y2:c,r:radius},styles:{stroke:i.strokeStyle,fill:i.fillStyle}})},drawPath:function(){i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(u,h),i.lineTo(r,l),i.stroke(),k.push({shape:"path",cords:{lx:u,ly:h,x:r,y:l},styles:{stroke:i.strokeStyle}})},drawTriangle:function(){var e=a-d,t=s-c,n=Math.sqrt(e*e+t*t),o=a+n,r=s+n;d<a&&(o=a-n),c<s&&(r=s-n),i.fillStyle=this.getFillColor(),i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(a,s),i.lineTo(o,r),i.lineTo(d,c),i.lineTo(a,s),i.stroke(),i.fill(),k.push({shape:"triangle",cords:{x1:a,y1:s,x2:d,y2:c},styles:{stroke:i.strokeStyle,fill:i.fillStyle}})},draw3Point:function(){i.fillStyle=this.getFillColor(),i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(S[0].x,S[0].y),i.lineTo(S[1].x,S[1].y),i.lineTo(S[2].x,S[2].y),i.lineTo(S[0].x,S[0].y),i.stroke(),i.fill(),k.push({shape:"3-point",cords:{points:S},styles:{stroke:i.strokeStyle,fill:i.fillStyle}})},init:function(){n.width=e,n.height=t,document.querySelector("main").appendChild(n)}}}();draw.init(),draw.getCanvas().addEventListener("mousemove",function(e){draw.setXY(e),draw.writeXY(),"path"===draw.getShape()&&!0===draw.getIsDrawing()&&draw.draw()}),draw.getCanvas().addEventListener("mousedown",function(){"3-point"!==draw.getShape()&&(draw.setStart(),draw.setIsDrawing(!0))}),draw.getCanvas().addEventListener("mouseup",function(){"3-point"!==draw.getShape()&&(draw.setEnd(),draw.draw(),draw.setIsDrawing(!1))}),draw.getCanvas().addEventListener("mouseup",function(){"3-point"===draw.getShape()&&draw.setPoint()}),document.getElementById("btnRect").addEventListener("click",function(){draw.setShape("rectangle")}),document.getElementById("btnLine").addEventListener("click",function(){draw.setShape("line")}),document.getElementById("btnCircle").addEventListener("click",function(){draw.setShape("circle")}),document.getElementById("btnPath").addEventListener("click",function(){draw.setShape("path")}),document.getElementById("btnTriangle").addEventListener("click",function(){draw.setShape("triangle")}),document.getElementById("btn3Point").addEventListener("click",function(){draw.setShape("3-point")}),document.getElementById("strokeColor").addEventListener("change",function(){draw.setStrokeColor(document.getElementById("strokeColor").value)}),document.getElementById("randStrokeColor").addEventListener("change",function(){draw.setStrokeColor("")}),document.getElementById("fillColor").addEventListener("change",function(){draw.setFillColor(document.getElementById("fillColor").value)}),document.getElementById("randFillColor").addEventListener("change",function(){draw.setFillColor("")});